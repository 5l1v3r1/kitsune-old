TODO:
- Have someone test this transformation
- Double type is currently hard coded for the data structure and the buffers, fix this
- 


Notes:
- Buffers are allocated on the stack, and could possibly cause a stack overflow. 
